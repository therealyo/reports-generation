import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);
var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// stacks/ReceivingEmail.ts
import { use as use2, Function as Function2 } from "sst/constructs";
import * as lambdaEventSources from "aws-cdk-lib/aws-lambda-event-sources";
import { ReceiptRuleSet } from "aws-cdk-lib/aws-ses";
import * as s3 from "aws-cdk-lib/aws-s3";
import * as actions from "aws-cdk-lib/aws-ses-actions";

// stacks/Database.ts
import { aws_rds } from "aws-cdk-lib";
import {
  InstanceClass,
  InstanceSize,
  InstanceType,
  Peer,
  Port,
  SecurityGroup,
  SubnetType,
  Vpc
} from "aws-cdk-lib/aws-ec2";
function Database({ stack }) {
  const vpc = new Vpc(stack, "database-vpc", {
    maxAzs: 3,
    subnetConfiguration: [
      {
        name: "public-db",
        subnetType: SubnetType.PUBLIC,
        cidrMask: 24
      },
      {
        name: "private",
        subnetType: SubnetType.PRIVATE_WITH_EGRESS,
        cidrMask: 24
      }
    ]
  });
  const secGroup = new SecurityGroup(
    stack,
    "allow_database_connection_from_internet",
    {
      vpc
    }
  );
  secGroup.addIngressRule(Peer.ipv4("0.0.0.0/0"), Port.tcp(5432));
  const db = new aws_rds.DatabaseInstance(stack, "reports-database", {
    engine: aws_rds.DatabaseInstanceEngine.postgres({
      version: aws_rds.PostgresEngineVersion.VER_14_1
    }),
    publiclyAccessible: true,
    instanceType: InstanceType.of(InstanceClass.BURSTABLE3, InstanceSize.MICRO),
    vpc,
    vpcSubnets: {
      subnets: vpc.publicSubnets
    },
    securityGroups: [secGroup],
    databaseName: "reports",
    storageEncrypted: false
  });
  db.connections.allowDefaultPortFromAnyIpv4();
  return {
    db,
    vpc,
    secGroup
  };
}
__name(Database, "Database");

// stacks/PDFGeneration.ts
import { Function } from "sst/constructs";
import * as lambda from "aws-cdk-lib/aws-lambda";
function ReportGeneration({ stack }) {
  const pdfGeneration = new Function(stack, "pdf-generation", {
    handler: "src/pdfGeneration.handler",
    layers: [
      lambda.LayerVersion.fromLayerVersionArn(
        stack,
        "pdf-layer",
        process.env.LAMBDA_LAYER_ARN
      )
    ],
    nodejs: {
      install: ["@sparticuz/chromium", "puppeteer-core"]
    },
    runtime: "nodejs16.x",
    functionName: "pdf-generation-from-html"
  });
  return {
    pdfGeneration
  };
}
__name(ReportGeneration, "ReportGeneration");

// stacks/ReceivingEmail.ts
import iam from "aws-cdk-lib/aws-iam";
function ReceivingEmail({ stack }) {
  const { vpc, secGroup, db } = use2(Database);
  const { pdfGeneration } = use2(ReportGeneration);
  const bucket = new s3.Bucket(stack, "ReportsBucket", {
    bucketName: process.env.BUCKET_NAME
  });
  const lambda2 = new Function2(stack, "bucket-handler", {
    handler: "src/parseEmail.handler",
    vpc,
    securityGroups: [secGroup],
    environment: {
      BUCKET_NAME: bucket.bucketName,
      ACCESS_KEY: process.env.ACCESS_KEY,
      SECRET_ACCESS_KEY: process.env.SECRET_ACCESS_KEY,
      DATABASE_SECRET: db.secret?.secretName,
      DATABASE_PORT: db.dbInstanceEndpointPort,
      DATABASE_HOST: db.dbInstanceEndpointAddress,
      PDF_LAMBDA_NAME: pdfGeneration.functionName,
      SEND_TO: process.env.SEND_TO,
      SOURCE_EMAIL: process.env.SOURCE_EMAIL,
      AUTHENTICATION: process.env.AUTHENTICATION,
      AUTHORIZATION: process.env.AUTHORIZATION
    },
    functionName: "report_generation"
  });
  lambda2.attachPermissions(["s3"]);
  lambda2.attachPermissions(["secretsmanager"]);
  pdfGeneration.grantInvoke(lambda2);
  lambda2.addToRolePolicy(
    new iam.PolicyStatement({
      actions: ["ses:SendEmail", "SES:SendRawEmail"],
      resources: ["*"],
      effect: iam.Effect.ALLOW
    })
  );
  const s3PutEventSource = new lambdaEventSources.S3EventSource(bucket, {
    events: [s3.EventType.OBJECT_CREATED_PUT]
  });
  lambda2.addEventSource(s3PutEventSource);
  const reactToReportEmail = new ReceiptRuleSet(stack, "email rule", {
    rules: [
      {
        recipients: [process.env.DOMAIN_NAME],
        actions: [
          new actions.S3({
            bucket
          })
        ],
        enabled: true
      }
    ]
  });
  return {
    lambda: lambda2,
    bucket,
    reactToReportEmail
  };
}
__name(ReceivingEmail, "ReceivingEmail");

// sst.config.ts
import { config } from "dotenv";

// stacks/SendReports.ts
import { use as use3, Function as Function3, Cron } from "sst/constructs";
import { Schedule } from "aws-cdk-lib/aws-events";
import iam2 from "aws-cdk-lib/aws-iam";
function SendReports({ stack }) {
  const { pdfGeneration } = use3(ReportGeneration);
  const { db } = use3(Database);
  const sendEmailsLambda = new Function3(stack, "cron-lambda", {
    handler: "src/sendEmail.handler",
    environment: {
      PDF_LAMBDA_NAME: pdfGeneration.functionName,
      DATABASE_SECRET: db.secret?.secretName,
      SEND_TO: process.env.SEND_TO,
      SOURCE_EMAIL: process.env.SOURCE_EMAIL,
      AUTHENTICATION: process.env.AUTHENTICATION,
      AUTHORIZATION: process.env.AUTHORIZATION
    },
    functionName: "send-emails-lambda"
  });
  const cron = new Cron(stack, "send-email-cron", {
    job: sendEmailsLambda,
    cdk: {
      rule: {
        schedule: Schedule.expression("cron(* * * * ? *)")
      }
    }
  });
  sendEmailsLambda.addToRolePolicy(
    new iam2.PolicyStatement({
      actions: ["ses:SendEmail", "SES:SendRawEmail"],
      resources: ["*"],
      effect: iam2.Effect.ALLOW
    })
  );
  sendEmailsLambda.attachPermissions(["secretsmanager"]);
  pdfGeneration.grantInvoke(sendEmailsLambda);
  return {
    cron
  };
}
__name(SendReports, "SendReports");

// sst.config.ts
config();
var sst_config_default = {
  config(_input) {
    return {
      name: "report-generation",
      region: "us-east-1"
    };
  },
  stacks(app) {
    app.stack(Database);
    app.stack(ReportGeneration);
    app.stack(ReceivingEmail);
    app.stack(SendReports);
  }
};
export {
  sst_config_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3RhY2tzL1JlY2VpdmluZ0VtYWlsLnRzIiwgInN0YWNrcy9EYXRhYmFzZS50cyIsICJzdGFja3MvUERGR2VuZXJhdGlvbi50cyIsICJzc3QuY29uZmlnLnRzIiwgInN0YWNrcy9TZW5kUmVwb3J0cy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgU3RhY2tDb250ZXh0LCB1c2UsIEZ1bmN0aW9uIH0gZnJvbSBcInNzdC9jb25zdHJ1Y3RzXCI7XHJcbmltcG9ydCAqIGFzIGxhbWJkYUV2ZW50U291cmNlcyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWxhbWJkYS1ldmVudC1zb3VyY2VzXCI7XHJcbmltcG9ydCB7IFJlY2VpcHRSdWxlU2V0IH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1zZXNcIjtcclxuaW1wb3J0ICogYXMgczMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1zM1wiO1xyXG5pbXBvcnQgKiBhcyBhY3Rpb25zIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtc2VzLWFjdGlvbnNcIjtcclxuaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tIFwiLi9EYXRhYmFzZVwiO1xyXG5pbXBvcnQgeyBSZXBvcnRHZW5lcmF0aW9uIH0gZnJvbSBcIi4vUERGR2VuZXJhdGlvblwiO1xyXG5pbXBvcnQgaWFtIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtaWFtXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gUmVjZWl2aW5nRW1haWwoeyBzdGFjayB9OiBTdGFja0NvbnRleHQpIHtcclxuICBjb25zdCB7IHZwYywgc2VjR3JvdXAsIGRiIH0gPSB1c2UoRGF0YWJhc2UpO1xyXG4gIGNvbnN0IHsgcGRmR2VuZXJhdGlvbiB9ID0gdXNlKFJlcG9ydEdlbmVyYXRpb24pO1xyXG5cclxuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCBcIlJlcG9ydHNCdWNrZXRcIiwge1xyXG4gICAgYnVja2V0TmFtZTogcHJvY2Vzcy5lbnYuQlVDS0VUX05BTUUsXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGxhbWJkYSA9IG5ldyBGdW5jdGlvbihzdGFjaywgXCJidWNrZXQtaGFuZGxlclwiLCB7XHJcbiAgICBoYW5kbGVyOiBcInNyYy9wYXJzZUVtYWlsLmhhbmRsZXJcIixcclxuICAgIHZwYyxcclxuICAgIHNlY3VyaXR5R3JvdXBzOiBbc2VjR3JvdXBdLFxyXG4gICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgQlVDS0VUX05BTUU6IGJ1Y2tldC5idWNrZXROYW1lLFxyXG4gICAgICBBQ0NFU1NfS0VZOiBwcm9jZXNzLmVudi5BQ0NFU1NfS0VZISxcclxuICAgICAgU0VDUkVUX0FDQ0VTU19LRVk6IHByb2Nlc3MuZW52LlNFQ1JFVF9BQ0NFU1NfS0VZISxcclxuICAgICAgREFUQUJBU0VfU0VDUkVUOiBkYi5zZWNyZXQ/LnNlY3JldE5hbWUhLFxyXG4gICAgICBEQVRBQkFTRV9QT1JUOiBkYi5kYkluc3RhbmNlRW5kcG9pbnRQb3J0LFxyXG4gICAgICBEQVRBQkFTRV9IT1NUOiBkYi5kYkluc3RhbmNlRW5kcG9pbnRBZGRyZXNzLFxyXG4gICAgICBQREZfTEFNQkRBX05BTUU6IHBkZkdlbmVyYXRpb24uZnVuY3Rpb25OYW1lLFxyXG4gICAgICBTRU5EX1RPOiBwcm9jZXNzLmVudi5TRU5EX1RPISxcclxuICAgICAgU09VUkNFX0VNQUlMOiBwcm9jZXNzLmVudi5TT1VSQ0VfRU1BSUwhLFxyXG4gICAgICBBVVRIRU5USUNBVElPTjogcHJvY2Vzcy5lbnYuQVVUSEVOVElDQVRJT04hLFxyXG4gICAgICBBVVRIT1JJWkFUSU9OOiBwcm9jZXNzLmVudi5BVVRIT1JJWkFUSU9OISxcclxuICAgIH0sXHJcbiAgICBmdW5jdGlvbk5hbWU6IFwicmVwb3J0X2dlbmVyYXRpb25cIixcclxuICB9KTtcclxuICBsYW1iZGEuYXR0YWNoUGVybWlzc2lvbnMoW1wiczNcIl0pO1xyXG4gIGxhbWJkYS5hdHRhY2hQZXJtaXNzaW9ucyhbXCJzZWNyZXRzbWFuYWdlclwiXSk7XHJcbiAgcGRmR2VuZXJhdGlvbi5ncmFudEludm9rZShsYW1iZGEpO1xyXG5cclxuICBsYW1iZGEuYWRkVG9Sb2xlUG9saWN5KFxyXG4gICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xyXG4gICAgICBhY3Rpb25zOiBbXCJzZXM6U2VuZEVtYWlsXCIsIFwiU0VTOlNlbmRSYXdFbWFpbFwiXSxcclxuICAgICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxyXG4gICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXHJcbiAgICB9KVxyXG4gICk7XHJcbiAgLy8gbGFtYmRhLmF0dGFjaFBlcm1pc3Npb25zKFtcInNlc1wiXSlcclxuXHJcbiAgY29uc3QgczNQdXRFdmVudFNvdXJjZSA9IG5ldyBsYW1iZGFFdmVudFNvdXJjZXMuUzNFdmVudFNvdXJjZShidWNrZXQsIHtcclxuICAgIGV2ZW50czogW3MzLkV2ZW50VHlwZS5PQkpFQ1RfQ1JFQVRFRF9QVVRdLFxyXG4gIH0pO1xyXG5cclxuICBsYW1iZGEuYWRkRXZlbnRTb3VyY2UoczNQdXRFdmVudFNvdXJjZSk7XHJcblxyXG4gIGNvbnN0IHJlYWN0VG9SZXBvcnRFbWFpbCA9IG5ldyBSZWNlaXB0UnVsZVNldChzdGFjaywgXCJlbWFpbCBydWxlXCIsIHtcclxuICAgIHJ1bGVzOiBbXHJcbiAgICAgIHtcclxuICAgICAgICByZWNpcGllbnRzOiBbcHJvY2Vzcy5lbnYuRE9NQUlOX05BTUUhXSxcclxuICAgICAgICBhY3Rpb25zOiBbXHJcbiAgICAgICAgICBuZXcgYWN0aW9ucy5TMyh7XHJcbiAgICAgICAgICAgIGJ1Y2tldCxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgfSxcclxuICAgIF0sXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBsYW1iZGEsXHJcbiAgICBidWNrZXQsXHJcbiAgICByZWFjdFRvUmVwb3J0RW1haWwsXHJcbiAgfTtcclxufVxyXG4iLCAiaW1wb3J0IHsgYXdzX3JkcyB9IGZyb20gXCJhd3MtY2RrLWxpYlwiO1xyXG5pbXBvcnQge1xyXG4gIEluc3RhbmNlQ2xhc3MsXHJcbiAgSW5zdGFuY2VTaXplLFxyXG4gIEluc3RhbmNlVHlwZSxcclxuICBQZWVyLFxyXG4gIFBvcnQsXHJcbiAgU2VjdXJpdHlHcm91cCxcclxuICBTdWJuZXRUeXBlLFxyXG4gIFZwYyxcclxufSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWVjMlwiO1xyXG5pbXBvcnQgeyBTdGFja0NvbnRleHQgfSBmcm9tIFwic3N0L2NvbnN0cnVjdHNcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBEYXRhYmFzZSh7IHN0YWNrIH06IFN0YWNrQ29udGV4dCkge1xyXG4gIGNvbnN0IHZwYyA9IG5ldyBWcGMoc3RhY2ssIFwiZGF0YWJhc2UtdnBjXCIsIHtcclxuICAgIG1heEF6czogMyxcclxuICAgIHN1Ym5ldENvbmZpZ3VyYXRpb246IFtcclxuICAgICAge1xyXG4gICAgICAgIG5hbWU6IFwicHVibGljLWRiXCIsXHJcbiAgICAgICAgc3VibmV0VHlwZTogU3VibmV0VHlwZS5QVUJMSUMsXHJcbiAgICAgICAgY2lkck1hc2s6IDI0LFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogXCJwcml2YXRlXCIsXHJcbiAgICAgICAgc3VibmV0VHlwZTogU3VibmV0VHlwZS5QUklWQVRFX1dJVEhfRUdSRVNTLFxyXG4gICAgICAgIGNpZHJNYXNrOiAyNCxcclxuICAgICAgfSxcclxuICAgIF0sXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IHNlY0dyb3VwID0gbmV3IFNlY3VyaXR5R3JvdXAoXHJcbiAgICBzdGFjayxcclxuICAgIFwiYWxsb3dfZGF0YWJhc2VfY29ubmVjdGlvbl9mcm9tX2ludGVybmV0XCIsXHJcbiAgICB7XHJcbiAgICAgIHZwYzogdnBjLFxyXG4gICAgfVxyXG4gICk7XHJcbiAgc2VjR3JvdXAuYWRkSW5ncmVzc1J1bGUoUGVlci5pcHY0KFwiMC4wLjAuMC8wXCIpLCBQb3J0LnRjcCg1NDMyKSk7XHJcblxyXG4gIGNvbnN0IGRiID0gbmV3IGF3c19yZHMuRGF0YWJhc2VJbnN0YW5jZShzdGFjaywgXCJyZXBvcnRzLWRhdGFiYXNlXCIsIHtcclxuICAgIGVuZ2luZTogYXdzX3Jkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLnBvc3RncmVzKHtcclxuICAgICAgdmVyc2lvbjogYXdzX3Jkcy5Qb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE0XzEsXHJcbiAgICB9KSxcclxuICAgIHB1YmxpY2x5QWNjZXNzaWJsZTogdHJ1ZSxcclxuICAgIGluc3RhbmNlVHlwZTogSW5zdGFuY2VUeXBlLm9mKEluc3RhbmNlQ2xhc3MuQlVSU1RBQkxFMywgSW5zdGFuY2VTaXplLk1JQ1JPKSxcclxuICAgIHZwYzogdnBjLFxyXG4gICAgdnBjU3VibmV0czoge1xyXG4gICAgICBzdWJuZXRzOiB2cGMucHVibGljU3VibmV0cyxcclxuICAgIH0sXHJcbiAgICBzZWN1cml0eUdyb3VwczogW3NlY0dyb3VwXSxcclxuICAgIGRhdGFiYXNlTmFtZTogXCJyZXBvcnRzXCIsXHJcbiAgICBzdG9yYWdlRW5jcnlwdGVkOiBmYWxzZSxcclxuICB9KTtcclxuICBkYi5jb25uZWN0aW9ucy5hbGxvd0RlZmF1bHRQb3J0RnJvbUFueUlwdjQoKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGRiLFxyXG4gICAgdnBjLFxyXG4gICAgc2VjR3JvdXAsXHJcbiAgfTtcclxufVxyXG4iLCAiaW1wb3J0IHsgU3RhY2tDb250ZXh0LCBBcGksIEZ1bmN0aW9uLCB1c2UgfSBmcm9tIFwic3N0L2NvbnN0cnVjdHNcIjtcclxuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbGFtYmRhXCI7XHJcbmltcG9ydCB7IFJlY2VpdmluZ0VtYWlsIH0gZnJvbSBcIi4vUmVjZWl2aW5nRW1haWxcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBSZXBvcnRHZW5lcmF0aW9uKHsgc3RhY2sgfTogU3RhY2tDb250ZXh0KSB7XHJcbiAgLy8gY29uc3QgeyBtYWluTGFtYmRhIH0gPSB1c2UoUmVjZWl2aW5nRW1haWwpO1xyXG4gIGNvbnN0IHBkZkdlbmVyYXRpb24gPSBuZXcgRnVuY3Rpb24oc3RhY2ssIFwicGRmLWdlbmVyYXRpb25cIiwge1xyXG4gICAgaGFuZGxlcjogXCJzcmMvcGRmR2VuZXJhdGlvbi5oYW5kbGVyXCIsXHJcbiAgICBsYXllcnM6IFtcclxuICAgICAgbGFtYmRhLkxheWVyVmVyc2lvbi5mcm9tTGF5ZXJWZXJzaW9uQXJuKFxyXG4gICAgICAgIHN0YWNrLFxyXG4gICAgICAgIFwicGRmLWxheWVyXCIsXHJcbiAgICAgICAgcHJvY2Vzcy5lbnYuTEFNQkRBX0xBWUVSX0FSTiFcclxuICAgICAgKSxcclxuICAgIF0sXHJcbiAgICBub2RlanM6IHtcclxuICAgICAgaW5zdGFsbDogW1wiQHNwYXJ0aWN1ei9jaHJvbWl1bVwiLCBcInB1cHBldGVlci1jb3JlXCJdLFxyXG4gICAgfSxcclxuICAgIHJ1bnRpbWU6IFwibm9kZWpzMTYueFwiLFxyXG4gICAgZnVuY3Rpb25OYW1lOiBcInBkZi1nZW5lcmF0aW9uLWZyb20taHRtbFwiLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgcGRmR2VuZXJhdGlvbixcclxuICB9O1xyXG59XHJcbiIsICJpbXBvcnQgeyBTU1RDb25maWcgfSBmcm9tIFwic3N0XCI7XHJcbmltcG9ydCB7IFJlY2VpdmluZ0VtYWlsIH0gZnJvbSBcIi4vc3RhY2tzL1JlY2VpdmluZ0VtYWlsXCI7XHJcblxyXG5pbXBvcnQgeyBjb25maWcgfSBmcm9tIFwiZG90ZW52XCI7XHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSBcIi4vc3RhY2tzL0RhdGFiYXNlXCI7XHJcbmltcG9ydCB7IFJlcG9ydEdlbmVyYXRpb24gfSBmcm9tIFwiLi9zdGFja3MvUERGR2VuZXJhdGlvblwiO1xyXG5pbXBvcnQgeyBTZW5kUmVwb3J0cyB9IGZyb20gXCIuL3N0YWNrcy9TZW5kUmVwb3J0c1wiO1xyXG5jb25maWcoKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICBjb25maWcoX2lucHV0KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiBcInJlcG9ydC1nZW5lcmF0aW9uXCIsXHJcbiAgICAgIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIixcclxuICAgIH07XHJcbiAgfSxcclxuICBzdGFja3MoYXBwKSB7XHJcbiAgICBhcHAuc3RhY2soRGF0YWJhc2UpO1xyXG4gICAgYXBwLnN0YWNrKFJlcG9ydEdlbmVyYXRpb24pO1xyXG4gICAgYXBwLnN0YWNrKFJlY2VpdmluZ0VtYWlsKTtcclxuICAgIGFwcC5zdGFjayhTZW5kUmVwb3J0cyk7XHJcbiAgfSxcclxufSBzYXRpc2ZpZXMgU1NUQ29uZmlnO1xyXG4iLCAiaW1wb3J0IHsgU3RhY2tDb250ZXh0LCB1c2UsIEZ1bmN0aW9uLCBDcm9uIH0gZnJvbSBcInNzdC9jb25zdHJ1Y3RzXCI7XHJcbmltcG9ydCB7IFJlcG9ydEdlbmVyYXRpb24gfSBmcm9tIFwiLi9QREZHZW5lcmF0aW9uXCI7XHJcbmltcG9ydCB7IFNjaGVkdWxlIH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1ldmVudHNcIjtcclxuaW1wb3J0IGlhbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gXCIuL0RhdGFiYXNlXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gU2VuZFJlcG9ydHMoeyBzdGFjayB9OiBTdGFja0NvbnRleHQpIHtcclxuICBjb25zdCB7IHBkZkdlbmVyYXRpb24gfSA9IHVzZShSZXBvcnRHZW5lcmF0aW9uKTtcclxuICBjb25zdCB7IGRiIH0gPSB1c2UoRGF0YWJhc2UpO1xyXG4gIGNvbnN0IHNlbmRFbWFpbHNMYW1iZGEgPSBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiY3Jvbi1sYW1iZGFcIiwge1xyXG4gICAgaGFuZGxlcjogXCJzcmMvc2VuZEVtYWlsLmhhbmRsZXJcIixcclxuICAgIGVudmlyb25tZW50OiB7XHJcbiAgICAgIFBERl9MQU1CREFfTkFNRTogcGRmR2VuZXJhdGlvbi5mdW5jdGlvbk5hbWUsXHJcbiAgICAgIERBVEFCQVNFX1NFQ1JFVDogZGIuc2VjcmV0Py5zZWNyZXROYW1lISxcclxuICAgICAgU0VORF9UTzogcHJvY2Vzcy5lbnYuU0VORF9UTyEsXHJcbiAgICAgIFNPVVJDRV9FTUFJTDogcHJvY2Vzcy5lbnYuU09VUkNFX0VNQUlMISxcclxuICAgICAgQVVUSEVOVElDQVRJT046IHByb2Nlc3MuZW52LkFVVEhFTlRJQ0FUSU9OISxcclxuICAgICAgQVVUSE9SSVpBVElPTjogcHJvY2Vzcy5lbnYuQVVUSE9SSVpBVElPTiEsXHJcbiAgICB9LFxyXG4gICAgZnVuY3Rpb25OYW1lOiBcInNlbmQtZW1haWxzLWxhbWJkYVwiLFxyXG4gIH0pO1xyXG4gIGNvbnN0IGNyb24gPSBuZXcgQ3JvbihzdGFjaywgXCJzZW5kLWVtYWlsLWNyb25cIiwge1xyXG4gICAgam9iOiBzZW5kRW1haWxzTGFtYmRhLFxyXG4gICAgY2RrOiB7XHJcbiAgICAgIHJ1bGU6IHtcclxuICAgICAgICBzY2hlZHVsZTogU2NoZWR1bGUuZXhwcmVzc2lvbihcImNyb24oKiAqICogKiA/ICopXCIpLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICB9KTtcclxuICBzZW5kRW1haWxzTGFtYmRhLmFkZFRvUm9sZVBvbGljeShcclxuICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcclxuICAgICAgYWN0aW9uczogW1wic2VzOlNlbmRFbWFpbFwiLCBcIlNFUzpTZW5kUmF3RW1haWxcIl0sXHJcbiAgICAgIHJlc291cmNlczogW1wiKlwiXSxcclxuICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxyXG4gICAgfSlcclxuICApO1xyXG4gIHNlbmRFbWFpbHNMYW1iZGEuYXR0YWNoUGVybWlzc2lvbnMoW1wic2VjcmV0c21hbmFnZXJcIl0pO1xyXG5cclxuICBwZGZHZW5lcmF0aW9uLmdyYW50SW52b2tlKHNlbmRFbWFpbHNMYW1iZGEpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgY3JvbixcclxuICB9O1xyXG59XHJcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7O0FBQUEsU0FBdUIsT0FBQUEsTUFBSyxZQUFBQyxpQkFBZ0I7QUFDNUMsWUFBWSx3QkFBd0I7QUFDcEMsU0FBUyxzQkFBc0I7QUFDL0IsWUFBWSxRQUFRO0FBQ3BCLFlBQVksYUFBYTs7O0FDSnpCLFNBQVMsZUFBZTtBQUN4QjtBQUFBLEVBQ0U7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsT0FDSztBQUdBLFNBQVMsU0FBUyxFQUFFLE1BQU0sR0FBaUI7QUFDaEQsUUFBTSxNQUFNLElBQUksSUFBSSxPQUFPLGdCQUFnQjtBQUFBLElBQ3pDLFFBQVE7QUFBQSxJQUNSLHFCQUFxQjtBQUFBLE1BQ25CO0FBQUEsUUFDRSxNQUFNO0FBQUEsUUFDTixZQUFZLFdBQVc7QUFBQSxRQUN2QixVQUFVO0FBQUEsTUFDWjtBQUFBLE1BQ0E7QUFBQSxRQUNFLE1BQU07QUFBQSxRQUNOLFlBQVksV0FBVztBQUFBLFFBQ3ZCLFVBQVU7QUFBQSxNQUNaO0FBQUEsSUFDRjtBQUFBLEVBQ0YsQ0FBQztBQUVELFFBQU0sV0FBVyxJQUFJO0FBQUEsSUFDbkI7QUFBQSxJQUNBO0FBQUEsSUFDQTtBQUFBLE1BQ0U7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUNBLFdBQVMsZUFBZSxLQUFLLEtBQUssV0FBVyxHQUFHLEtBQUssSUFBSSxJQUFJLENBQUM7QUFFOUQsUUFBTSxLQUFLLElBQUksUUFBUSxpQkFBaUIsT0FBTyxvQkFBb0I7QUFBQSxJQUNqRSxRQUFRLFFBQVEsdUJBQXVCLFNBQVM7QUFBQSxNQUM5QyxTQUFTLFFBQVEsc0JBQXNCO0FBQUEsSUFDekMsQ0FBQztBQUFBLElBQ0Qsb0JBQW9CO0FBQUEsSUFDcEIsY0FBYyxhQUFhLEdB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QUFBLE1BQ1g7QUFBQSxJQUNGO0FBQUEsRUFDRixDQUFDO0FBRUQsU0FBTztBQUFBLElBQ0wsUUFBQUE7QUFBQSxJQUNBO0FBQUEsSUFDQTtBQUFBLEVBQ0Y7QUFDRjtBQWpFZ0I7OztBR05oQixTQUFTLGNBQWM7OztBQ0h2QixTQUF1QixPQUFBRSxNQUFLLFlBQUFDLFdBQVUsWUFBWTtBQUVsRCxTQUFTLGdCQUFnQjtBQUN6QixPQUFPQyxVQUFTO0FBR1QsU0FBUyxZQUFZLEVBQUUsTUFBTSxHQUFpQjtBQUNuRCxRQUFNLEVBQUUsY0FBYyxJQUFJQyxLQUFJLGdCQUFnQjtBQUM5QyxRQUFNLEVBQUUsR0FBRyxJQUFJQSxLQUFJLFFBQVE7QUFDM0IsUUFBTSxtQkFBbUIsSUFBSUMsVUFBUyxPQUFPLGVBQWU7QUFBQSxJQUMxRCxTQUFTO0FBQUEsSUFDVCxhQUFhO0FBQUEsTUFDWCxpQkFBaUIsY0FBYztBQUFBLE1BQy9CLGlCQUFpQixHQUFHLFFBQVE7QUFBQSxNQUM1QixTQUFTLFFBQVEsSUFBSTtBQUFBLE1BQ3JCLGNBQWMsUUFBUSxJQUFJO0FBQUEsTUFDMUIsZ0JBQWdCLFFBQVEsSUFBSTtBQUFBLE1BQzVCLGVBQWUsUUFBUSxJQUFJO0FBQUEsSUFDN0I7QUFBQSxJQUNBLGNBQWM7QUFBQSxFQUNoQixDQUFDO0FBQ0QsUUFBTSxPQUFPLElBQUksS0FBSyxPQUFPLG1CQUFtQjtBQUFBLElBQzlDLEtBQUs7QUFBQSxJQUNMLEtBQUs7QUFBQSxNQUNILE1BQU07QUFBQSxRQUNKLFVBQVUsU0FBUyxXQUFXLG1CQUFtQjtBQUFBLE1BQ25EO0FBQUEsSUFDRjtBQUFBLEVBQ0YsQ0FBQztBQUNELG1CQUFpQjtBQUFBLElBQ2YsSUFBSUMsS0FBSSxnQkFBZ0I7QUFBQSxNQUN0QixTQUFTLENBQUMsaUJBQWlCLGtCQUFrQjtBQUFBLE1BQzdDLFdBQVcsQ0FBQyxHQUFHO0FBQUEsTUFDZixRQUFRQSxLQUFJLE9BQU87QUFBQSxJQUNyQixDQUFDO0FBQUEsRUFDSDtBQUNBLG1CQUFpQixrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQztBQUVyRCxnQkFBYyxZQUFZLGdCQUFnQjtBQUUxQyxTQUFPO0FBQUEsSUFDTDtBQUFBLEVBQ0Y7QUFDRjtBQXJDZ0I7OztBRENoQixPQUFPO0FBRVAsSUFBTyxxQkFBUTtBQUFBLEVBQ2IsT0FBTyxRQUFRO0FBQ2IsV0FBTztBQUFBLE1BQ0wsTUFBTTtBQUFBLE1BQ04sUUFBUTtBQUFBLElBQ1Y7QUFBQSxFQUNGO0FBQUEsRUFDQSxPQUFPLEtBQUs7QUFDVixRQUFJLE1BQU0sUUFBUTtBQUNsQixRQUFJLE1BQU0sZ0JBQWdCO0FBQzFCLFFBQUksTUFBTSxjQUFjO0FBQ3hCLFFBQUksTUFBTSxXQUFXO0FBQUEsRUFDdkI7QUFDRjsiLAogICJuYW1lcyI6IFsidXNlIiwgIkZ1bmN0aW9uIiwgInVzZSIsICJsYW1iZGEiLCAiRnVuY3Rpb24iLCAidXNlIiwgIkZ1bmN0aW9uIiwgImlhbSIsICJ1c2UiLCAiRnVuY3Rpb24iLCAiaWFtIl0KfQo=
